#!usr/bin/python3
from pwn import *
from Crypto.Util.number import bytes_to_long, long_to_bytes

# =========================================================
#                          SETUP                         
# =========================================================
host, port = 'ctf-gemastik.ub.ac.id', 10002
io = remote(host, port)

# =========================================================
#                         EXPLOITS
# =========================================================
io.sendlineafter(b'>', b'2')
io.recvuntil(b'ciphertext = ')
secret_ct = int(io.recvline().strip().decode())

custom_pt = bytes_to_long(b'A'*128)
io.sendlineafter(b'>', b'1')
io.sendlineafter(b'=', str(custom_pt).encode())
io.recvuntil(b'ciphertext = ')
custom_ct = int(io.recvline().strip().decode())

info('secrect ct: %d', secret_ct)
info('custom pt: %d', custom_pt)
info('custom ct: %d', custom_ct)

secret_ct = long_to_bytes(secret_ct)
custom_ct = long_to_bytes(custom_ct)

secret_pt = list((map(lambda a, b: a ^ b, secret_ct, custom_ct)))
secret_pt = list((map(lambda a, b: a ^ b, secret_pt, b'A'*128)))
secret_pt = bytes(secret_pt)
secret_pt = bytes_to_long(secret_pt)

io.sendlineafter(b'>', b'3')
io.sendlineafter(b'secret:', str(secret_pt).encode())

io.interactive()